{%- liquid
  assign section_id = section.id
-%}

{%- style -%}
  .section-{{ section_id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section_id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  {%- if section.settings.background_color != blank -%}
    .comfort-performance-slider[data-section-id="{{ section_id }}"] {
      background-color: {{ section.settings.background_color }};
    }
  {%- endif -%}
    
    {%- if section.settings.background_overlay -%}
      .comfort-performance-slider[data-section-id="{{ section_id }}"]::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, {{ section.settings.overlay_opacity | divided_by: 100.0 }});
        z-index: 0;
      }
    {%- endif -%}
  
{%- endstyle -%}

<div class="comfort-performance-slider section-{{ section_id }}-padding {% if section.settings.show_card %}comfort-performance-slider--with-card{% else %}comfort-performance-slider--without-card{% endif %}" data-section-id="{{ section_id }}">
  <div class="section">
    {%- if section.settings.title != blank -%}
      <div class="comfort-performance-slider__header {% if section.settings.title_alignment == 'center' %}comfort-performance-slider__header--center{% endif %}" style="text-align: {{ section.settings.title_alignment }};">
        <h2 class="comfort-performance-slider__title">
          {{ section.settings.title }}
        </h2>
      </div>
    {%- endif -%}

    {%- if section.blocks.size > 0 -%}
      <div class="comfort-performance-slider__wrapper">
        <div class="comfort-performance-slider__carousel" data-slider-id="{{ section_id }}">
          {%- for block in section.blocks -%}
            <div class="comfort-performance-slider__slide" {{ block.shopify_attributes }}>
              <div class="comfort-performance-slider__card{% unless section.settings.show_card %} comfort-performance-slider__card--no-style{% endunless %}">
                <div class="comfort-performance-slider__image-wrapper">
                  {%- if block.settings.image != blank -%}
                    <img
                      src="{{ block.settings.image | img_url: '600x600' }}"
                      alt="{{ block.settings.image.alt | escape }}"
                      loading="lazy"
                      class="comfort-performance-slider__image"
                    >
                  {%- else -%}
                    <div class="comfort-performance-slider__image-placeholder">
                      {{ 'image' | placeholder_svg_tag: 'placeholder-svg' }}
                    </div>
                  {%- endif -%}
                </div>
                <div class="comfort-performance-slider__content">
                  {%- if block.settings.title != blank -%}
                    <h3 class="comfort-performance-slider__card-title">
                      {{ block.settings.title }}
                    </h3>
                  {%- endif -%}
                  {%- if block.settings.description != blank -%}
                    <div class="comfort-performance-slider__card-description">
                      {{ block.settings.description }}
                    </div>
                    {%- if block.settings.show_connecting_line -%}
                      <div class="comfort-performance-slider__connecting-line"></div>
                    {%- endif -%}
                  {%- endif -%}
                </div>
              </div>
            </div>
          {%- endfor -%}
        </div>

        {%- if section.blocks.size > 1 -%}
        <div class="main__progress_with_arrows">
          <div class="comfort-performance-slider__navigation">
            <button type="button" class="comfort-performance-slider__arrow comfort-performance-slider__arrow--prev" aria-label="Previous">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <button type="button" class="comfort-performance-slider__arrow comfort-performance-slider__arrow--next" aria-label="Next">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>

          <div class="comfort-performance-slider__progress">
            <div class="comfort-performance-slider__progress-bar"></div>
          </div>
        </div>
        {%- endif -%}
      </div>
    {%- endif -%}
  </div>
</div>

<style>
  .comfort-performance-slider {
    background: #fff;
  }
    .main__progress_with_arrows {
        display: flex;
        align-items: center;
        gap: 10px;
        flex-direction: row-reverse;
    }
  .comfort-performance-slider__header {
    margin-bottom: 40px;
  }
    @media screen and (min-width: 992px) {
        .comfort-performance-slider__header--center .comfort-performance-slider__title {
          max-width: 54%;
          width: 100%;
          margin: 0 auto;
        }
    }
  .comfort-performance-slider__title {
    font-size: 34px;
    font-weight: 700;
    color: #000;
    margin: 0;
    line-height: 100%;
  }

  .comfort-performance-slider__wrapper {
    position: relative;
  }

  .comfort-performance-slider__carousel {
    margin-bottom: 30px;
  }

  .comfort-performance-slider__slide {
    padding: 0 15px;
  }

  .comfort-performance-slider__card {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    position: relative;
    overflow: visible;
  }

  .comfort-performance-slider__card--no-style:hover {
    transform: none !important;
    box-shadow: none !important;
  }
    .comfort-performance-slider--without-card .comfort-performance-slider__card:hover {
        transform: none !important;
        box-shadow: none !important;
    }
  .comfort-performance-slider__card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
  }
    .comfort-performance-slider__card--no-style {
    background: transparent;
    border-radius: 0;
    padding: 0;
    box-shadow: none;
    transition: none;
  }
  .comfort-performance-slider {
    position: relative;
  }

  .comfort-performance-slider > .page-width {
    position: relative;
    z-index: 1;
  }

  .comfort-performance-slider__image-wrapper {
    margin-bottom: 24px;
    text-align: center;
    position: relative;
  }

  .comfort-performance-slider__image {
    width: 100%;
    height: auto;
    max-width: 315px;
    margin: 0;
    display: block;
    object-fit: contain;
  }

  @media screen and (min-width: 1390px) and (max-width: 1440px) {
    .comfort-performance-slider__image {
      min-width: 315px;
      min-height: 405px;
    }
  }

  .comfort-performance-slider__image-placeholder {
    width: 100%;
    height: 300px;
    background: #e9ecef;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
  }

  .comfort-performance-slider__content {
    position: relative;
  }

  .comfort-performance-slider__card-title {
    font-size: 18px;
    font-weight: 700;
    color: #000;
    margin: 0 0 12px 0;
    line-height: 1.4;
  }

  .comfort-performance-slider__card-description {
    font-size: 14px;
    color: #333;
    line-height: 1.6;
    margin-bottom: 16px;
    position: relative;
  }

  .comfort-performance-slider__connecting-line {
    position: absolute;
    bottom: -8px;
    left: 0;
    width: 60px;
    height: 2px;
    background: #e81f25;
    z-index: 1;
  }

  .comfort-performance-slider__navigation {
    position: relative;
    display: flex;
    gap: 8px;
    z-index: 10;
  }

  .comfort-performance-slider__arrow {
    width: 28.33px;
    height: 28.33px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    color: #000;
  }

  .comfort-performance-slider__arrow:hover {
    background: #000;
    color: #fff;
    border-color: #000;
  }

  .comfort-performance-slider__arrow svg {
    width: 24px;
    height: 24px;
  }

  .comfort-performance-slider__arrow--prev {
    transform: rotate(0deg);
  }

  .comfort-performance-slider__arrow--next {
    transform: rotate(0deg);
  }

  .comfort-performance-slider__progress {
    width: 100%;
    height: 4px;
    background: #e0e0e0;
    border-radius: 2px;
    overflow: hidden;
  }

  .comfort-performance-slider__progress-bar {
    height: 100%;
    background: #BFBFBF;
    width: 0%;
    transition: width 0.3s ease;
    border-radius: 2px;
  }

  @media (max-width: 768px) {
    .comfort-performance-slider__title {
      font-size: 24px;
    }

    .comfort-performance-slider__card,
    .comfort-performance-slider__slide {
      padding: 0px;
      padding-right:10px;
    }
    .comfort-performance-slider__image{
      max-width: 100%;
    }
    .comfort-performance-slider__image-wrapper{
      margin-bottom: 0px;
    }

    .comfort-performance-slider__navigation {
      bottom: 10px;
      right: 10px;
    }

    .comfort-performance-slider__arrow {
      width: 36px;
      height: 36px;
    }
  }
</style>

<script>
  (function() {
    function initSlider() {
      const section = document.querySelector('[data-section-id="{{ section_id }}"]');
      if (!section) return;

      const slider = section.querySelector('.comfort-performance-slider__carousel');
      const prevBtn = section.querySelector('.comfort-performance-slider__arrow--prev');
      const nextBtn = section.querySelector('.comfort-performance-slider__arrow--next');
      const progressBar = section.querySelector('.comfort-performance-slider__progress-bar');
      const slides = section.querySelectorAll('.comfort-performance-slider__slide');

      if (!slider || slides.length <= 1) return;

      // Wait for jQuery and Slick to be available
      if (typeof jQuery === 'undefined' || !jQuery.fn.slick) {
        setTimeout(initSlider, 100);
        return;
      }

      // Initialize Slick slider
      jQuery(slider).slick({
        slidesToShow: 4,
        slidesToScroll: 1,
        infinite: false,
        arrows: false,
        dots: false,
        autoplay: false,
        responsive: [
          {
            breakpoint: 1024,
            settings: {
              slidesToShow: 3
            }
          },
          {
            breakpoint: 768,
            settings: {
              slidesToShow: 2
            }
          },
          {
            breakpoint: 480,
            settings: {
              slidesToShow: 1.3
            }
          }
        ]
      });

      // Update progress bar
      function updateProgress() {
        const currentSlide = jQuery(slider).slick('slickCurrentSlide');
        const totalSlides = slides.length;
        const progress = ((currentSlide + 1) / totalSlides) * 100;
        if (progressBar) {
          progressBar.style.width = progress + '%';
        }
      }

      // Navigation buttons
      if (prevBtn) {
        prevBtn.addEventListener('click', function() {
          jQuery(slider).slick('slickPrev');
        });
      }

      if (nextBtn) {
        nextBtn.addEventListener('click', function() {
          jQuery(slider).slick('slickNext');
        });
      }

      // Update progress on slide change
      jQuery(slider).on('afterChange', function() {
        updateProgress();
      });

      // Initialize progress
      updateProgress();
    }

    // Initialize on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initSlider);
    } else {
      initSlider();
    }
  })();
</script>

{% schema %}
{
  "name": "Performance Slider",
  "tag": "section",
  "class": "comfort-performance-slider-section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Crafted for Comfort. Built for Performance."
    },
    {
      "type": "select",
      "id": "title_alignment",
      "label": "Title Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "checkbox",
      "id": "show_card",
      "label": "Show Card Background",
      "default": true,
      "info": "Enable to show cards with background, disable for transparent cards"
    },
    {
      "type": "header",
      "content": "Background Settings"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Section Background Color"
    },
    {
      "type": "checkbox",
      "id": "background_overlay",
      "label": "Show Background Overlay",
      "default": false,
      "info": "Add a dark overlay on the background image for better text readability"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "%",
      "label": "Overlay Opacity",
      "default": 30
    },
    {
      "type": "header",
      "content": "Section Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 200,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 60
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title",
          "default": "Card Title"
        },
        {
          "type": "richtext",
          "id": "description",
          "label": "Description",
          "default": "<p>Card description text goes here.</p>"
        },
        {
          "type": "checkbox",
          "id": "show_connecting_line",
          "label": "Show Connecting Line",
          "default": true
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Performance Slider",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        },
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}

